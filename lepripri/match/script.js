/* ===================================================== PRIPRI MATCH — SCRIPT PROPRE & STABLE ===================================================== */ /* =============================== CONFIG ================================ */ const GRID_COLS = 7; const GRID_ROWS = 8; const MAX_ENERGY = 100; const ENERGY_REGEN_TIME = 120000; const NON_FUSIONABLE_PREFIX = ["CFR", "CEN"]; const COMMAND_MIN = 3; const COMMAND_MAX = 6; /* =============================== JOUEUR ================================ */ const player = { energy: MAX_ENERGY, money: 0, level: 1 }; /* =============================== PERSONNAGES ================================ */ const PERSONS = [ { id: "camille", bonus: 0.1 }, { id: "farceur", bonus: 0.1 }, { id: "gourmand", bonus: 0.3 }, { id: "dixo", bonus: 0.2 }, { id: "maman", bonus: 0.1 }, { id: "papa", bonus: 0.1 }, { id: "voyageur", bonus: 0.1 }, { id: "plancequot", bonus: 0, noReward: true }, { id: "intelligent", bonus: 0.15 }, { id: "djixy", bonus: 0.1 } ]; /* =============================== OBJETS ================================ */ const OBJECT_NAMES = { CPP1: "pripri simple", CPP2: "pripri double", CPP3: "pripri triple", CPP4: "pripri quadruple", CPP5: "pripri RJ45", CPP6: "pripri USB", CPP7: "pripri 7 USB", CPP8: "⚡ maman pripri", CPP9: "⚡ pripri extraterrestre", BBP1: "bébé pripri", BBP2: "pripri ados", BEP1: "bébé pripri extraterrestre", BEP2: "ados extraterrestre", BEP3: "jeune extraterrestre", BEP4: "adulte extraterrestre", BEP5: "ancien extraterrestre", ENR1: "⚡ 2 énergies", ENR2: "⚡ 5 énergies", ENR3: "⚡ 15 énergies", ENR4: "⚡ 40 énergies", ENR5: "⚡ 100 énergies" }; /* =============================== OBJET MATCH ================================ */ class MatchObject { constructor(id, level = 1) { this.id = id; this.level = level; this.productionCount = 0; this.cooldownUntil = 0; } } /* =============================== PLATEAU ================================ */ const gridCells = Array.from(document.querySelectorAll("#grid th")); function clearGrid() { gridCells.forEach(c => { c.innerHTML = ""; c.matchObject = null; }); } function placeObject(cell, obj) { cell.innerHTML = ""; const img = document.createElement("img"); img.src = icons/${obj.id}.png; img.draggable = true; img.dataset.id = obj.id; img.dataset.level = obj.level; cell.appendChild(img); cell.matchObject = obj; } /* =============================== FUSION ================================ */ function canMerge(a, b) { if (!a || !b) return false; if (a.dataset.id !== b.dataset.id) return false; for (const p of NON_FUSIONABLE_PREFIX) { if (a.dataset.id.startsWith(p)) return false; } return Number(a.dataset.level) === Number(b.dataset.level); } function mergeCells(from, to) { const a = from.querySelector("img"); const b = to.querySelector("img"); if (!canMerge(a, b)) return; const newLevel = Number(a.dataset.level) + 1; const newId = a.dataset.id.substring(0, 3) + newLevel; from.innerHTML = ""; from.matchObject = null; placeObject(to, new MatchObject(newId, newLevel)); } /* =============================== DRAG & DROP ================================ */ let draggedCell = null; gridCells.forEach(cell => { cell.addEventListener("dragstart", e => { if (!cell.matchObject) return; draggedCell = cell; e.target.style.opacity = 0.4; }); cell.addEventListener("dragend", e => { e.target.style.opacity = ""; }); cell.addEventListener("dragover", e => e.preventDefault()); cell.addEventListener("drop", e => { e.preventDefault(); if (!draggedCell || draggedCell === cell) return; if (cell.matchObject) { mergeCells(draggedCell, cell); } else { cell.appendChild(draggedCell.firstChild); cell.matchObject = draggedCell.matchObject; draggedCell.innerHTML = ""; draggedCell.matchObject = null; } }); }); /* =============================== COMMANDES ================================ */ let activeCommands = []; function generateCommand() { const person = PERSONS[Math.floor(Math.random() * PERSONS.length)]; const lvl = Math.max(1, Math.floor(player.level)); return { person, target: { id: "CPP" + Math.min(9, lvl), level: lvl } }; } function initCommands() { activeCommands = []; const count = COMMAND_MIN + Math.floor(Math.random() * (COMMAND_MAX - COMMAND_MIN + 1)); for (let i = 0; i < count; i++) activeCommands.push(generateCommand()); } function tryCompleteCommand(matchObject, cell) { const index = activeCommands.findIndex(c => c.target.id === matchObject.id && c.target.level === matchObject.level ); if (index === -1) return false; const cmd = activeCommands[index]; if (!cmd.person.noReward) { player.money += 20; player.energy = Math.min(MAX_ENERGY, player.energy + 5); player.level += cmd.person.bonus; } cell.innerHTML = ""; cell.matchObject = null; activeCommands.splice(index, 1); activeCommands.push(generateCommand()); return true; } /* =============================== DOUBLE CLIC ================================ */ gridCells.forEach(cell => { cell.addEventListener("dblclick", () => { if (!cell.matchObject) return; if (tryCompleteCommand(cell.matchObject, cell)) { alert("Commande complétée !"); return; } if (cell.matchObject.id.startsWith("ENR")) { const values = [2, 5, 15, 40, 100]; player.energy = Math.min( MAX_ENERGY, player.energy + values[cell.matchObject.level - 1] ); cell.innerHTML = ""; cell.matchObject = null; } }); }); /* =============================== ÉNERGIE AUTO ================================ */ setInterval(() => { if (player.energy < MAX_ENERGY) player.energy++; document.querySelector(".energy").textContent = player.energy; }, ENERGY_REGEN_TIME); /* =============================== INIT ================================ */ clearGrid(); placeObject(gridCells[17], new MatchObject("CPP1", 1)); placeObject(gridCells[23], new MatchObject("CPP1", 1)); placeObject(gridCells[24], new MatchObject("CPP1", 1)); initCommands(); document.querySelector(".energy").textContent = player.energy; document.querySelector(".money").textContent = player.money;
